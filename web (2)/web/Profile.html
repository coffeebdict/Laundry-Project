<!DOCTYPE html>
<html style="font-size: 16px" lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="keywords" content="PROFILE, SUKI POINTS​, Details" />
    <meta name="description" content="" />
    <title>Profile</title>
    <link rel="stylesheet" href="nicepage.css" media="screen" />
    <link rel="stylesheet" href="Profile.css" media="screen" />
    <script
      class="u-script"
      type="text/javascript"
      src="jquery-1.9.1.min.js"
      defer=""
    ></script>
    <script
      class="u-script"
      type="text/javascript"
      src="nicepage.js"
      defer=""
    ></script>
    <meta name="generator" content="Nicepage 6.10.5, nicepage.com" />
    <link
      id="u-theme-google-font"
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i"
    />
    <link
      id="u-page-google-font"
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
    />

    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "WebSite6261320"
      }
    </script>
    <meta name="theme-color" content="#2359e8" />
    <meta property="og:title" content="Profile" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta data-intl-tel-input-cdn-path="intlTelInput/" />
  </head>
  <body
    data-path-to-root="./"
    data-include-products="false"
    class="u-body u-xl-mode"
    data-lang="en"
  >
    <section class="u-clearfix u-custom-color-2 u-section-1" id="sec-1db4">
      <div
        class="u-clearfix u-group-elements u-group-elements-1"
        data-href="Service.html"
      >
        <p class="u-align-center u-custom-font u-heading-font u-text u-text-1">
          BACK
        </p>
        <div
          class="u-flip-horizontal u-shape u-shape-svg u-text-white u-shape-1"
          data-href="Service.html"
        >
          <svg
            class="u-svg-link"
            preserveAspectRatio="none"
            viewBox="0 0 160 140"
          >
            <use xlink:href="#svg-6373"></use>
          </svg>
          <svg
            class="u-svg-content"
            viewBox="0 0 160 140"
            x="0px"
            y="0px"
            id="svg-6373"
            style="enable-background: new 0 0 160 140"
          >
            <path d="M90,45H0v50h90v45l70-70L90,0V45z"></path>
          </svg>
        </div>
      </div>
      <h1 class="u-align-center u-custom-font u-heading-font u-text u-text-2">
        PROFILE
      </h1>
      <div
        class="u-border-3 u-border-white u-line u-line-horizontal u-line-1"
      ></div>
      <div
        class="u-container-style u-custom-color-3 u-expanded-width u-group u-opacity u-opacity-30 u-shape-rectangle u-group-1"
      >
        <div class="u-container-layout u-valign-middle u-container-layout-1">
          <div class="u-clearfix u-group-elements u-group-elements-2">
            <img
              class="u-align-left u-expanded-height u-image u-image-default u-preserve-proportions u-image-1"
              src="images/profileicon.png"
              alt=""
              data-image-width="1080"
              data-image-height="1080"
            />
            <p
              id="user-name"
              class="u-custom-font u-heading-font u-text u-text-3"
            >
              <!-- User name is placed here -->
            </p>
            <p
              id="user-number"
              class="u-custom-font u-heading-font u-text u-text-4"
            >
              <!-- User number is placed here -->
            </p>
          </div>
        </div>
      </div>
      <div
        class="u-clearfix u-container-align-left u-group-elements u-group-elements-3"
      >
        <h1 class="u-align-left u-custom-font u-heading-font u-text u-text-5">
          SUKI POINTS
        </h1>
        <div
          class="u-align-left u-border-3 u-border-white u-expanded-width u-line u-line-horizontal u-line-2"
        ></div>
      </div>
      <div
        class="u-clearfix u-container-align-left u-group-elements u-group-elements-4"
      >
        <h1 class="u-align-left u-custom-font u-heading-font u-text u-text-6">
          Details
        </h1>
        <div
          class="u-align-left u-border-3 u-border-white u-expanded-width u-line u-line-horizontal u-line-3"
        ></div>
      </div>
      <p id="suki-points" class="u-custom-font u-heading-font u-text u-text-7">
        <!-- User suki points is placed here -->
      </p>
      <p
        id="suki-points-converted"
        class="u-custom-font u-heading-font u-text u-text-8"
      >
        <!-- User converted suki points is placed here -->
      </p>
      <p class="u-text u-text-9" style="font-style: italic">N​AME</p>
      <p
        id="detail-name"
        class="u-custom-font u-heading-font u-text u-text-10"
        style="font-style: italic"
      >
        <!-- User first & last name is placed here -->
      </p>
      <p
        class="u-custom-font u-heading-font u-text u-text-11"
        style="font-style: italic"
      >
        EMAIL
      </p>
      <p
        id="detail-email"
        class="u-custom-font u-heading-font u-text u-text-12"
        style="font-style: italic"
      >
        <!-- User email is placed here -->
      </p>
      <div class="u-clearfix u-group-elements u-group-elements-5">
        <h1 class="u-align-left u-custom-font u-heading-font u-text u-text-13">
          ORDER SUMMARY
        </h1>
        <div
          class="u-align-left u-border-3 u-border-white u-expanded-width u-line u-line-horizontal u-line-4"
        ></div>
      </div>
      <p class="u-custom-font u-heading-font u-text u-text-14">TOTAL ORDERS</p>
      <p
        id="summary-orders"
        class="u-custom-font u-heading-font u-text u-text-15"
      >
        <!-- User total order is placed here -->
      </p>
      <p class="u-custom-font u-heading-font u-text u-text-16">TOTAL</p>
      <p
        id="summary-spent"
        class="u-custom-font u-heading-font u-text u-text-17"
      >
        <!-- User total spent is placed here -->
      </p>
      <p
        class="u-custom-font u-heading-font u-text u-text-18"
        style="font-style: italic"
      >
        PHONE NUMBER
      </p>
      <p
        id="detail-number"
        class="u-custom-font u-heading-font u-text u-text-19"
        style="font-style: italic"
      >
        <!-- User number is placed here -->
      </p>

      <div
        class="u-clearfix u-container-align-left u-group-elements u-group-elements-6"
      >
        <h1 class="u-align-left u-custom-font u-heading-font u-text u-text-20">
          ORDER HISTORY (Pending)
        </h1>
        <div
          class="u-align-left u-border-3 u-border-white u-expanded-width u-line u-line-horizontal u-line-5"
        ></div>
      </div>
      <div id="order-history">
        <table id="order-table">
          <thead>
            <tr>
              <th class="u-align-center u-text">RETRIEVAL DATE</th>
              <th class="u-align-center u-text">SERVICE</th>
              <th class="u-align-center u-text">PRODUCT</th>
              <th class="u-align-center u-text">WEIGHT</th>
              <th class="u-align-center u-text">TOTAL PRICE</th>
              <th class="u-align-center u-text">SUKI POINTS</th>
            </tr>
          </thead>
          <tbody id="order-history-body">
            <!-- Orders will be appended here -->
          </tbody>
        </table>
      </div>
    </section>

    <style>
      #order-table {
        width: 90%;
        border-collapse: collapse;
        margin: 0 5rem 2rem 7rem;
      }

      th {
        font-weight: 700;
        font-size: 1.7rem;
      }

      td {
        font-size: 1.5rem;
      }
    </style>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
      import {
        getFirestore,
        query,
        where,
        getDoc,
        doc,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBfT3seQuX-KktG9YUls2yXdqTf-BaEnLo",
        authDomain: "laundry-38b7f.firebaseapp.com",
        projectId: "laundry-38b7f",
        storageBucket: "laundry-38b7f.appspot.com",
        messagingSenderId: "513313646509",
        appId: "1:513313646509:web:f605ba365885acb462e324",
        measurementId: "G-5L8CQQS95N",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const userDocRef = sessionStorage.getItem("userDocRef");

      // Function to fetch user data from Firestore
      async function fetchUserData() {
        try {
          const docSnap = await getDoc(doc(db, userDocRef));
          if (docSnap.exists()) {
            const userData = docSnap.data();
            const firstName = userData.firstName;
            const lastName = userData.lastName;
            const number = userData.number;
            const sukiPoints = userData.sukiPoints;
            const email = userData.email;
            const total_order = userData.total_order;
            const total_spent = userData.total_spent;

            // Display user data in the header
            document.getElementById("user-name").innerText =
              firstName + " " + lastName;
            document.getElementById("user-number").innerText = number;
            document.getElementById("suki-points").innerText = sukiPoints;
            document.getElementById("suki-points-converted").innerText =
              "- ₱" + sukiPoints.toFixed(2);
            document.getElementById("detail-name").innerText =
              firstName + " " + lastName;
            document.getElementById("detail-email").innerText = email;
            document.getElementById("detail-number").innerText = number;
            document.getElementById("summary-orders").innerText = total_order;
            document.getElementById("summary-spent").innerText =
              "₱" + total_spent.toFixed(2);

            // Fetch and display user's order history
            const orderHistoryBody =
              document.getElementById("order-history-body");

            for (const orderRef of userData.orders) {
              const orderSnap = await getDoc(orderRef);
              if (orderSnap.exists()) {
                const orderData = orderSnap.data();

                if (orderData.status === "Pending") {
                  const orderRow = document.createElement("tr");
                  const receiveDate = orderData.receiveDate;
                  const formattedReceiveDate = new Date(
                    receiveDate.seconds * 1000
                  ).toLocaleDateString("en-US", { timeZone: "UTC" });
                  const totalPrice = orderData.totalPrice.toFixed(2);

                  orderRow.innerHTML = `
                  <td class="u-align-center u-text">${formattedReceiveDate}</td>
                  <td class="u-align-center u-text">${orderData.serviceType}</td>
                  <td class="u-align-center u-text">${orderData.detergentType}</td>
                  <td class="u-align-center u-text">${orderData.weight} KG</td>
                  <td class="u-align-center u-text">₱${totalPrice}</td>
                  <td class="u-align-center u-text">${orderData.sukiPoints}</td>
              `;

                  orderHistoryBody.appendChild(orderRow);
                }
              }
            }
          } else {
            console.log("No such document!");
          }
        } catch (error) {
          console.error("Error fetching user data: ", error);
        }
      }

      // Call fetchUserData function
      fetchUserData();
    </script>
  </body>
</html>
